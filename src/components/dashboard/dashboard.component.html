
<div class="flex flex-col h-full gap-6 animate-fade-in">
  
  <!-- Header & Filters -->
  <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between items-center gap-4 transition-colors">
    <div>
      <h2 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
         <i class="fas fa-chart-line text-blue-600"></i> Dashboard Ejecutivo
      </h2>
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Métricas de rendimiento e integración con Planta.</p>
    </div>
    
    <div class="flex items-center gap-3">
       <div class="flex items-center gap-2 bg-gray-50 dark:bg-gray-700 p-1.5 rounded-lg border border-gray-200 dark:border-gray-600 shadow-inner">
          <input type="date" [(ngModel)]="startDate" class="bg-transparent text-xs font-bold text-gray-700 dark:text-gray-200 outline-none p-1 cursor-pointer">
          <span class="text-gray-400 text-xs">-</span>
          <input type="date" [(ngModel)]="endDate" class="bg-transparent text-xs font-bold text-gray-700 dark:text-gray-200 outline-none p-1 cursor-pointer">
       </div>
       <button (click)="loadData()" [disabled]="isLoading()" 
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold shadow-lg shadow-blue-500/30 transition-all flex items-center gap-2 text-sm disabled:opacity-70 disabled:cursor-not-allowed">
          <i class="fas fa-sync-alt" [class.fa-spin]="isLoading()"></i>
       </button>
    </div>
  </div>

  @if(stats()) {
     <!-- KPI CARDS -->
     <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Card 1: Success Rate -->
        <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 relative overflow-hidden group hover:shadow-md transition-all">
           <div class="flex justify-between items-start relative z-10">
              <div>
                 <p class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Tasa de Éxito</p>
                 <h3 class="text-3xl font-black text-gray-800 dark:text-white mt-1 tracking-tight">{{ stats()!.kpis.successRate }}%</h3>
              </div>
              <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg shadow-sm"
                 [ngClass]="stats()!.kpis.successRate >= 90 ? 'bg-green-50 text-green-600 dark:bg-green-900/30 dark:text-green-400' : 'bg-yellow-50 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400'">
                 <i class="fas" [class]="stats()!.kpis.successRate >= 90 ? 'fa-check' : 'fa-exclamation'"></i>
              </div>
           </div>
           <!-- Progress bar -->
           <div class="mt-4 w-full bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden relative z-10">
              <div class="h-full bg-gradient-to-r from-green-400 to-green-600 shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-1000 ease-out" [style.width.%]="stats()!.kpis.successRate"></div>
           </div>
           <!-- Decor -->
           <i class="fas fa-chart-pie absolute -right-4 -bottom-4 text-6xl text-gray-50 dark:text-gray-700/20 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
        </div>

        <!-- Card 2: Volume -->
        <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all group relative overflow-hidden">
           <div class="flex justify-between items-start relative z-10">
              <div>
                 <p class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Total Envíos</p>
                 <h3 class="text-3xl font-black text-gray-800 dark:text-white mt-1 tracking-tight">{{ stats()!.kpis.totalTransmissions }}</h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 flex items-center justify-center text-lg shadow-sm">
                 <i class="fas fa-paper-plane"></i>
              </div>
           </div>
           <p class="text-[10px] text-gray-400 mt-2 font-medium relative z-10">En el periodo seleccionado</p>
           <i class="fas fa-layer-group absolute -right-4 -bottom-4 text-6xl text-gray-50 dark:text-gray-700/20 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
        </div>

        <!-- Card 3: Errors -->
        <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all group relative overflow-hidden">
           <div class="flex justify-between items-start relative z-10">
              <div>
                 <p class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Errores</p>
                 <h3 class="text-3xl font-black text-gray-800 dark:text-white mt-1 tracking-tight">{{ stats()!.kpis.totalErrors }}</h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 flex items-center justify-center text-lg shadow-sm">
                 <i class="fas fa-bug"></i>
              </div>
           </div>
           <p class="text-[10px] text-red-400 mt-2 font-bold relative z-10 flex items-center gap-1">
              <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> Requieren atención
           </p>
           <i class="fas fa-exclamation-triangle absolute -right-4 -bottom-4 text-6xl text-gray-50 dark:text-gray-700/20 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
        </div>

        <!-- Card 4: Latency -->
        <div class="bg-white dark:bg-gray-800 p-5 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all group relative overflow-hidden">
           <div class="flex justify-between items-start relative z-10">
              <div>
                 <p class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Latencia API</p>
                 <h3 class="text-3xl font-black text-gray-800 dark:text-white mt-1 tracking-tight">{{ stats()!.kpis.avgResponseTime }} <span class="text-sm font-bold text-gray-400">ms</span></h3>
              </div>
              <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400 flex items-center justify-center text-lg shadow-sm">
                 <i class="fas fa-stopwatch"></i>
              </div>
           </div>
           <p class="text-[10px] text-gray-400 mt-2 font-medium relative z-10">Tiempo promedio respuesta</p>
           <i class="fas fa-bolt absolute -right-4 -bottom-4 text-6xl text-gray-50 dark:text-gray-700/20 transform rotate-12 group-hover:scale-110 transition-transform duration-500"></i>
        </div>
     </div>

     <!-- CHARTS ROW -->
     <div class="flex flex-col lg:flex-row gap-6 flex-1 min-h-0">
        
        <!-- Trend Chart -->
        <div class="lg:w-2/3 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col overflow-hidden">
           <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800">
              <h3 class="font-bold text-gray-700 dark:text-gray-200 text-sm flex items-center gap-2">
                 <i class="fas fa-wave-square text-blue-500"></i> Tendencia de Transmisión
              </h3>
              <div class="flex gap-4 text-[10px] font-bold uppercase tracking-wider">
                 <span class="flex items-center gap-1.5 text-gray-500 dark:text-gray-400"><div class="w-2 h-2 bg-green-500 rounded-full shadow-[0_0_5px_rgba(34,197,94,0.6)]"></div> Exitosos</span>
                 <span class="flex items-center gap-1.5 text-gray-500 dark:text-gray-400"><div class="w-2 h-2 bg-red-500 rounded-full shadow-[0_0_5px_rgba(239,68,68,0.6)]"></div> Errores</span>
              </div>
           </div>
           <div class="flex-1 p-4 relative bg-gradient-to-b from-white to-gray-50 dark:from-gray-800 dark:to-gray-900" #trendChart>
              <!-- D3 Renders Here -->
           </div>
        </div>

        <!-- Donut Chart -->
        <div class="lg:w-1/3 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col overflow-hidden">
           <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
              <h3 class="font-bold text-gray-700 dark:text-gray-200 text-sm flex items-center gap-2">
                 <i class="fas fa-chart-pie text-purple-500"></i> Distribución de Errores
              </h3>
           </div>
           <div class="flex-1 p-4 flex flex-col items-center justify-center bg-white dark:bg-gray-800" #donutChart>
              <!-- D3 Renders Here -->
           </div>
        </div>
     </div>
  } @else if(isLoading()) {
     <div class="flex-1 flex flex-col items-center justify-center text-gray-400 h-96">
        <div class="relative">
           <div class="w-16 h-16 border-4 border-blue-100 dark:border-gray-700 border-t-blue-600 rounded-full animate-spin"></div>
           <div class="absolute inset-0 flex items-center justify-center text-blue-600">
              <i class="fas fa-chart-bar"></i>
           </div>
        </div>
        <p class="mt-4 font-medium text-sm text-gray-500">Analizando datos...</p>
     </div>
  }
</div>
